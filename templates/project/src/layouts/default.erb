<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="canonical" href="<%= canonical_url %>">
  <%= meta_tags %>
  <link rel="stylesheet" href="<%= asset_path('styles.css') %>">
  <script src="<%= asset_path('vendor/stimulus.umd.js') %>" defer></script>
</head>
<body>
  <header class="header">
    <nav class="nav">
      <a href="/" class="logo"><%= site.title %></a>
      <div class="nav-links">
        <% if nav_links.any? %>
          <% nav_links.each do |entry| %>
            <% if entry.type == :link %>
              <a href="<%= entry.url %>"><%= entry.title %></a>
            <% elsif entry.type == :group %>
              <div class="nav-group">
                <span class="nav-group-label"><%= entry.title %></span>
                <div class="nav-dropdown">
                  <% entry.children.each do |child| %>
                    <a href="<%= child.url %>"><%= child.title %></a>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <% fallback_nav_links.each do |entry| %>
            <a href="<%= entry.url %>"><%= entry.title %></a>
          <% end %>
        <% end %>
      </div>
    </nav>
  </header>

  <main class="main">
    <%= content %>
  </main>

  <footer class="footer">
    <p>&copy; 2025 <%= site.title %>. Built with Comet.</p>
  </footer>

  <!-- Defer controllers so Stimulus (also deferred) initializes first -->
  <script src="<%= asset_path('controllers/comet_shard_controller.js') %>" defer></script>
  <script src="<%= asset_path('controllers/shard_counter_controller.js') %>" defer></script>
  <script src="<%= asset_path('controllers/shard_props_viewer_controller.js') %>" defer></script>
  <script src="<%= asset_path('controllers/shard_filter_list_controller.js') %>" defer></script>
</body>
</html>
